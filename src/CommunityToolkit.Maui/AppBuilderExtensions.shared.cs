using CommunityToolkit.Maui.Core;
using CommunityToolkit.Maui.Core.Handlers;
using CommunityToolkit.Maui.Views;

namespace CommunityToolkit.Maui;

/// <summary>
/// Extensions for MauiAppBuilder
/// </summary>
public static class AppBuilderExtensions
{
	/// <summary>
	/// Initializes the .NET Maui Community Toolkit Library
	/// </summary>
	/// <param name="builder"><see cref="MauiAppBuilder"/> generated by <see cref="MauiApp"/> </param>
	/// <returns><see cref="MauiAppBuilder"/> initialized for <see cref="CommunityToolkit.Maui"/></returns>
	public static MauiAppBuilder UseMauiCommunityToolkit(this MauiAppBuilder builder)
	{
		builder.ConfigureMauiHandlers(h =>
		{
			h.AddHandler<DrawingView, DrawingViewHandler>();
			h.AddHandler<Popup, PopupHandler>();
		});

		builder.ConfigureImageSources();

		Popup.RemapForControls();

		return builder.UseMauiCommunityToolkitCore();
	}

	/// <summary>Configures image source handlers.</summary>
	/// <param name="builder"><see cref="MauiAppBuilder"/> generated by <see cref="MauiApp"/> </param>
	/// <returns><see cref="MauiAppBuilder"/> initialized for <see cref="Maui"/></returns>
	public static MauiAppBuilder ConfigureImageSources(this MauiAppBuilder builder)
	{
		builder.ConfigureImageSources(services => services.AddService(svcs => new GravatarImageSourceService(new UriImageSourceService(), svcs.CreateLogger<GravatarImageSourceService>())));
		return builder;
	}
}